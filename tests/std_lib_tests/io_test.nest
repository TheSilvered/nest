|#| '../test_lib.nest' = test
|#| 'stdio.nest' = io

{ Byte :: 72, Byte :: 105 } = bytes -- Hi

'test_files\\file.txt' 'wb' @io.open = f
f bytes @io.write_bytes
f @io.close

'test_files\\file.txt' 'rb' @io.open = f
f -1 @io.read_bytes { Byte :: 72, Byte :: 105 } @test.assert_eq
f @io.close

'test_files\\file.txt' 'w' @io.open = f
f 'Hello' @io.write
f @io.close

'test_files\\file.txt' 'r' @io.open = f
f -1 @io.read 'Hello' @test.assert_eq
f @io.file_size 5 @test.assert_eq
f io.FROM_CUR -2 @io.move_fptr
f @io.get_fptr 3 @test.assert_eq
f -1 @io.read 'lo' @test.assert_eq
f @io.close

-- should appear in the standard output
io.STDOUT 'Using write and flush\n' @io.write
io.STDOUT @io.flush
